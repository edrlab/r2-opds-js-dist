{"version":3,"file":"test-JSON-AdditionalJSON.js","sourceRoot":"","sources":["../../../test/test-JSON-AdditionalJSON.ts"],"names":[],"mappings":"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","sourcesContent":["import test from \"ava\";\n\nimport { JsonArray, JsonMap, TaJsonDeserialize, TaJsonSerialize } from \"@r2-lcp-js/serializable\";\n\nimport { initGlobalConverters_GENERIC, initGlobalConverters_OPDS } from \"../src/opds/init-globals\";\nimport { OPDSFeed } from \"../src/opds/opds2/opds2\";\nimport { OPDSMetadata } from \"../src/opds/opds2/opds2-metadata\";\nimport {\n    checkType_Array, checkType_Number, checkType_Object, checkType_String, inspect, logJSON,\n} from \"./helpers\";\n\ninitGlobalConverters_OPDS();\ninitGlobalConverters_GENERIC();\n\n// ==========================\n\nconst titleStr1 = \"str1\";\nconst titleStr2 = \"str2\";\nconst titleStr3 = \"str3\";\nconst n = 999;\n\n// ==========================\n\ntest(\"JSON SERIALIZE: Metadata.AdditionalJSON\", (t) => {\n\n    const md = new OPDSMetadata();\n    md.Title = titleStr1;\n    md.NumberOfItems = n;\n    md.AdditionalJSON = {\n        title2: titleStr2,\n        tizz: {\n            sub1: true,\n            sub2: null,\n            sub3: {\n                inner1: n,\n                inner2: [titleStr3, 888, false],\n            },\n        },\n    };\n    const pub = new OPDSFeed();\n    pub.Metadata = md;\n    inspect(pub);\n\n    const jsonPub = TaJsonSerialize(pub);\n    logJSON(jsonPub);\n    const json = jsonPub.metadata as JsonMap;\n\n    checkType_Number(t, json.numberOfItems);\n    t.is(json.numberOfItems, n);\n\n    checkType_String(t, json.title);\n    t.is(json.title, titleStr1);\n\n    if (!json.tizz) {\n        t.fail();\n        return;\n    }\n    checkType_Object(t, json.tizz);\n\n    t.is((json.tizz as JsonMap).sub1, true);\n\n    if ((json.tizz as JsonMap).sub2 || (json.tizz as JsonMap).sub2 !== null) {\n        t.fail();\n        return;\n    }\n\n    if (!(json.tizz as JsonMap).sub3) {\n        t.fail();\n        return;\n    }\n\n    checkType_Number(t, ((json.tizz as JsonMap).sub3 as JsonMap).inner1);\n    t.is(((json.tizz as JsonMap).sub3 as JsonMap).inner1, n);\n\n    if (!((json.tizz as JsonMap).sub3 as JsonMap).inner2) {\n        t.fail();\n        return;\n    }\n    checkType_Array(t, ((json.tizz as JsonMap).sub3 as JsonMap).inner2);\n    t.is((((json.tizz as JsonMap).sub3 as JsonMap).inner2 as JsonArray)[0], titleStr3);\n\n    if (!((json.tizz as JsonMap).sub3 as JsonMap).inner1) {\n        t.fail();\n        return;\n    }\n});\n\ntest(\"JSON DESERIALIZE: Metadata.AdditionalJSON\", (t) => {\n\n    const json: JsonMap = {\n        numberOfItems: n,\n        title: titleStr1,\n        title2: titleStr2,\n        tizz: {\n            sub1: true,\n            sub2: null,\n            sub3: {\n                inner1: 999,\n                inner2: [titleStr3, 888, false],\n            },\n        },\n    };\n    const jsonPub: JsonMap = {\n        metadata: json,\n    };\n    logJSON(jsonPub);\n\n    const pub: OPDSFeed = TaJsonDeserialize<OPDSFeed>(jsonPub, OPDSFeed);\n    const md = pub.Metadata;\n    // const md: OPDSMetadata = TaJsonDeserialize<OPDSMetadata>(json, OPDSMetadata);\n    inspect(md);\n\n    checkType_Number(t, md.NumberOfItems);\n    t.is(md.NumberOfItems, n);\n\n    checkType_String(t, md.Title);\n    t.is(md.Title, titleStr1);\n\n    if (!md.AdditionalJSON) {\n        t.fail();\n        return;\n    }\n    checkType_String(t, md.AdditionalJSON.title2);\n    t.is(md.AdditionalJSON.title2, titleStr2);\n\n    if (!md.AdditionalJSON.tizz) {\n        t.fail();\n        return;\n    }\n    checkType_Object(t, md.AdditionalJSON.tizz);\n\n    t.is((md.AdditionalJSON.tizz as JsonMap).sub1, true);\n\n    if ((md.AdditionalJSON.tizz as JsonMap).sub2 ||\n        (md.AdditionalJSON.tizz as JsonMap).sub2 !== null) {\n        t.fail();\n        return;\n    }\n\n    if (!(md.AdditionalJSON.tizz as JsonMap).sub3) {\n        t.fail();\n        return;\n    }\n\n    checkType_Number(t, ((md.AdditionalJSON.tizz as JsonMap).sub3 as JsonMap).inner1);\n    t.is(((md.AdditionalJSON.tizz as JsonMap).sub3 as JsonMap).inner1, n);\n\n    if (!((md.AdditionalJSON.tizz as JsonMap).sub3 as JsonMap).inner2) {\n        t.fail();\n        return;\n    }\n    checkType_Array(t, ((md.AdditionalJSON.tizz as JsonMap).sub3 as JsonMap).inner2);\n    t.is((((md.AdditionalJSON.tizz as JsonMap).sub3 as JsonMap).inner2 as JsonArray)[0], titleStr3);\n\n    if (!((md.AdditionalJSON.tizz as JsonMap).sub3 as JsonMap).inner1) {\n        t.fail();\n        return;\n    }\n});\n"]}