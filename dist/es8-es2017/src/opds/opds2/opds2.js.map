{"version":3,"file":"opds2.js","sourceRoot":"","sources":["../../../../../src/opds/opds2/opds2.ts"],"names":[],"mappings":"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","sourcesContent":["import { JsonStringConverter } from \"@utils/ta-json-string-converter\";\n// https://github.com/edcarroll/ta-json\nimport {\n    JsonConverter,\n    JsonElementType,\n    JsonObject,\n    JsonProperty,\n    OnDeserialized,\n} from \"ta-json\";\n\nimport { OPDSFacet } from \"./opds2-facet\";\nimport { OPDSGroup } from \"./opds2-group\";\nimport { OPDSLink } from \"./opds2-link\";\nimport { OPDSMetadata } from \"./opds2-metadata\";\nimport { OPDSPublication } from \"./opds2-publication\";\n\n@JsonObject()\nexport class OPDSFeed {\n\n    @JsonProperty(\"@context\")\n    @JsonConverter(JsonStringConverter)\n    @JsonElementType(String)\n    public Context: string[];\n\n    @JsonProperty(\"metadata\")\n    public Metadata: OPDSMetadata;\n\n    @JsonProperty(\"links\")\n    @JsonElementType(OPDSLink)\n    public Links: OPDSLink[];\n\n    @JsonProperty(\"publications\")\n    @JsonElementType(OPDSPublication)\n    public Publications: OPDSPublication[];\n\n    @JsonProperty(\"navigation\")\n    @JsonElementType(OPDSLink)\n    public Navigation: OPDSLink[];\n\n    @JsonProperty(\"facets\")\n    @JsonElementType(OPDSFacet)\n    public Facets: OPDSFacet[];\n\n    @JsonProperty(\"groups\")\n    @JsonElementType(OPDSGroup)\n    public Groups: OPDSGroup[];\n\n    public findFirstLinkByRel(rel: string): OPDSLink | undefined {\n\n        return this.Links ? this.Links.find((l) => {\n            return l.HasRel(rel);\n        }) : undefined;\n    }\n\n    public AddLink(href: string, rel: string, typeLink: string, templated: boolean) {\n        const l = new OPDSLink();\n        l.Href = href;\n        l.AddRel(rel);\n        l.TypeLink = typeLink;\n        if (templated) {\n            l.Templated = true;\n        }\n        if (!this.Links) {\n            this.Links = [];\n        }\n        this.Links.push(l);\n    }\n\n    public AddNavigation(title: string, href: string, rel: string, typeLink: string) {\n        const l = new OPDSLink();\n        l.Href = href;\n        l.TypeLink = typeLink;\n        l.AddRel(rel);\n        if (title) {\n            l.Title = title;\n        }\n        if (!this.Navigation) {\n            this.Navigation = [];\n        }\n        this.Navigation.push(l);\n    }\n\n    public AddPagination(\n        numberItems: number, itemsPerPage: number, currentPage: number,\n        nextLink: string, prevLink: string,\n        firstLink: string, lastLink: string) {\n\n        if (!this.Metadata) {\n            this.Metadata = new OPDSMetadata();\n        }\n        this.Metadata.CurrentPage = currentPage;\n        this.Metadata.ItemsPerPage = itemsPerPage;\n        this.Metadata.NumberOfItems = numberItems;\n\n        if (nextLink) {\n            this.AddLink(nextLink, \"next\", \"application/opds+json\", false);\n        }\n        if (prevLink) {\n            this.AddLink(prevLink, \"previous\", \"application/opds+json\", false);\n        }\n        if (firstLink) {\n            this.AddLink(firstLink, \"first\", \"application/opds+json\", false);\n        }\n        if (lastLink) {\n            this.AddLink(lastLink, \"last\", \"application/opds+json\", false);\n        }\n    }\n\n    public AddFacet(link: OPDSLink, group: string) {\n\n        if (this.Facets) {\n            const found = this.Facets.find((f) => {\n                if (f.Metadata && f.Metadata.Title === group) {\n                    if (!f.Links) {\n                        f.Links = [];\n                    }\n                    f.Links.push(link);\n                    return true;\n                }\n                return false;\n            });\n            if (found) {\n                return;\n            }\n        }\n\n        const facet = new OPDSFacet();\n\n        facet.Metadata = new OPDSMetadata();\n        facet.Metadata.Title = group;\n\n        facet.Links = [];\n        facet.Links.push(link);\n\n        if (!this.Facets) {\n            this.Facets = [];\n        }\n        this.Facets.push(facet);\n    }\n\n    public AddPublicationInGroup(publication: OPDSPublication, collLink: OPDSLink) {\n\n        if (this.Groups) {\n            const found1 = this.Groups.find((g) => {\n                if (g.Links) {\n                    const found2 = g.Links.find((l) => {\n\n                        if (l.Href === collLink.Href) {\n                            if (!g.Publications) {\n                                g.Publications = [];\n                            }\n                            g.Publications.push(publication);\n                            return true;\n                        }\n                        return false;\n                    });\n                    if (found2) {\n                        return true;\n                    }\n                }\n                return false;\n            });\n\n            if (found1) {\n                return;\n            }\n        }\n\n        const group = new OPDSGroup();\n        group.Metadata = new OPDSMetadata();\n        group.Metadata.Title = collLink.Title;\n\n        group.Publications = [];\n        group.Publications.push(publication);\n\n        const linkSelf = new OPDSLink();\n        linkSelf.AddRel(\"self\");\n        linkSelf.Title = collLink.Title;\n        linkSelf.Href = collLink.Href;\n\n        group.Links = [];\n        group.Links.push(linkSelf);\n\n        if (!this.Groups) {\n            this.Groups = [];\n        }\n        this.Groups.push(group);\n    }\n\n    public AddNavigationInGroup(link: OPDSLink, collLink: OPDSLink) {\n\n        if (this.Groups) {\n            const found1 = this.Groups.find((g) => {\n                if (g.Links) {\n                    const found2 = g.Links.find((l) => {\n\n                        if (l.Href === collLink.Href) {\n                            if (!g.Navigation) {\n                                g.Navigation = [];\n                            }\n                            g.Navigation.push(link);\n                            return true;\n                        }\n                        return false;\n                    });\n                    if (found2) {\n                        return true;\n                    }\n                }\n                return false;\n            });\n\n            if (found1) {\n                return;\n            }\n        }\n\n        const group = new OPDSGroup();\n        group.Metadata = new OPDSMetadata();\n        group.Metadata.Title = collLink.Title;\n\n        group.Navigation = [];\n        group.Navigation.push(link);\n\n        const linkSelf = new OPDSLink();\n        linkSelf.AddRel(\"self\");\n        linkSelf.Title = collLink.Title;\n        linkSelf.Href = collLink.Href;\n\n        group.Links = [];\n        group.Links.push(link);\n\n        if (!this.Groups) {\n            this.Groups = [];\n        }\n        this.Groups.push(group);\n    }\n\n    @OnDeserialized()\n    // tslint:disable-next-line:no-unused-variable\n    // @ts-ignore: TS6133 (is declared but its value is never read.)\n    private _OnDeserialized() {\n        if (!this.Metadata) {\n            console.log(\"OPDS2Feed.Metadata is not set!\");\n        }\n        if (!this.Links) {\n            console.log(\"OPDS2Feed.Links is not set!\");\n        }\n    }\n}\n"]}