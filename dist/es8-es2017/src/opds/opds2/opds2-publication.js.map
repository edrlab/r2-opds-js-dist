{"version":3,"file":"opds2-publication.js","sourceRoot":"","sources":["../../../../../src/opds/opds2/opds2-publication.ts"],"names":[],"mappings":"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","sourcesContent":["// ==LICENSE-BEGIN==\n// Copyright 2017 European Digital Reading Lab. All rights reserved.\n// Licensed to the Readium Foundation under one or more contributor license agreements.\n// Use of this source code is governed by a BSD-style license\n// that can be found in the LICENSE file exposed on Github (readium) in the project repository.\n// ==LICENSE-END==\n\n// https://github.com/edcarroll/ta-json\nimport { JsonElementType, JsonObject, JsonProperty, OnDeserialized } from \"ta-json-x\";\n\nimport { Metadata } from \"@r2-shared-js/models/metadata\";\nimport { BelongsTo } from \"@r2-shared-js/models/metadata-belongsto\";\nimport { Contributor } from \"@r2-shared-js/models/metadata-contributor\";\nimport { Link } from \"@r2-shared-js/models/publication-link\";\n\nimport { OPDSLink } from \"./opds2-link\";\n\n// import { Publication } from \"@r2-shared-js/models/publication\";\n\nconst METADATA_JSON_PROP = \"metadata\";\nconst LINKS_JSON_PROP = \"links\";\nconst IMAGES_JSON_PROP = \"images\";\nconst IMAGE_JSON_PROP = \"image\";\n\n// tslint:disable-next-line:max-line-length\n// https://github.com/opds-community/drafts/blob/4d82fb9a64f35a174a5f205c23ba623ec010d5ec/schema/publication.schema.json\n@JsonObject()\nexport class OPDSPublication { // extends Publication\n\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/opds-community/drafts/blob/4d82fb9a64f35a174a5f205c23ba623ec010d5ec/schema/publication.schema.json#L7\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/readium/webpub-manifest/blob/0ac78ab5c270a608c39b4b04fc90bd9b1d281896/schema/publication.schema.json#L13\n    @JsonProperty(METADATA_JSON_PROP)\n    public Metadata!: Metadata;\n\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/opds-community/drafts/blob/4d82fb9a64f35a174a5f205c23ba623ec010d5ec/schema/publication.schema.json#L10\n    @JsonProperty(LINKS_JSON_PROP)\n    @JsonElementType(OPDSLink)\n    public Links!: OPDSLink[];\n\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/opds-community/drafts/blob/4d82fb9a64f35a174a5f205c23ba623ec010d5ec/schema/publication.schema.json#L52\n    @JsonProperty(IMAGES_JSON_PROP)\n    @JsonElementType(Link)\n    public Images!: Link[];\n\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/readium/r2-streamer-js/blob/751553db8c97d7a6d3ba9bc04f2153fbd7a8b4bc/misc/json-schema/opds/catalog-entry.schema.json#L40-L61\n    @JsonProperty(IMAGE_JSON_PROP)\n    public Image!: Link;\n\n    public findFirstLinkByRel(rel: string): OPDSLink | undefined {\n\n        return this.Links ? this.Links.find((l) => {\n            return l.HasRel(rel);\n        }) : undefined;\n    }\n\n    public AddImage(href: string, typeImage: string, height: number, width: number) {\n        const i = new Link();\n\n        i.Href = href;\n        i.TypeLink = typeImage;\n        if (height) {\n            i.Height = height;\n        }\n        if (width) {\n            i.Width = width;\n        }\n\n        if (!this.Images) {\n            this.Images = [];\n        }\n        this.Images.push(i);\n    }\n\n    public AddLink_(href: string, typeLink: string, rel: string, title: string) {\n        const l = new OPDSLink();\n        l.Href = href;\n        l.TypeLink = typeLink;\n        if (rel) {\n            l.AddRel(rel);\n        }\n        if (title) {\n            l.Title = title;\n        }\n\n        if (!this.Links) {\n            this.Links = [];\n        }\n        this.Links.push(l);\n    }\n\n    public AddAuthor(name: string, identifier: string, sortAs: string, href: string, typeLink: string) {\n        const c = new Contributor();\n        c.Name = name;\n        if (identifier) {\n            c.Identifier = identifier;\n        }\n        if (sortAs) {\n            c.SortAs = sortAs;\n        }\n\n        const l = new Link();\n        if (href) {\n            l.Href = href;\n        }\n        if (typeLink) {\n            l.TypeLink = typeLink;\n        }\n\n        if (href) {\n            c.Links = [];\n            c.Links.push(l);\n        }\n\n        if (!this.Metadata) {\n            this.Metadata = new Metadata();\n        }\n        if (!this.Metadata.Author) {\n            this.Metadata.Author = [];\n        }\n        this.Metadata.Author.push(c);\n    }\n\n    public AddSerie(name: string, position: number, href: string, typeLink: string) {\n\n        const c = new Contributor();\n        c.Name = name;\n        c.Position = position;\n\n        const l = new Link();\n        if (href) {\n            l.Href = href;\n        }\n        if (typeLink) {\n            l.TypeLink = typeLink;\n        }\n\n        if (href) {\n            c.Links = [];\n            c.Links.push(l);\n        }\n\n        if (!this.Metadata) {\n            this.Metadata = new Metadata();\n        }\n        if (!this.Metadata.BelongsTo) {\n            this.Metadata.BelongsTo = new BelongsTo();\n        }\n        if (!this.Metadata.BelongsTo.Series) {\n            this.Metadata.BelongsTo.Series = [];\n        }\n\n        this.Metadata.BelongsTo.Series.push(c);\n    }\n\n    public AddPublisher(name: string, href: string, typeLink: string) {\n        const c = new Contributor();\n        c.Name = name;\n\n        const l = new Link();\n        if (href) {\n            l.Href = href;\n        }\n        if (typeLink) {\n            l.TypeLink = typeLink;\n        }\n\n        if (href) {\n            c.Links = [];\n            c.Links.push(l);\n        }\n\n        if (!this.Metadata) {\n            this.Metadata = new Metadata();\n        }\n        if (!this.Metadata.Publisher) {\n            this.Metadata.Publisher = [];\n        }\n        this.Metadata.Publisher.push(c);\n    }\n\n    @OnDeserialized()\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore: TS6133 (is declared but its value is never read.)\n    protected _OnDeserialized() {\n        // tslint:disable-next-line:max-line-length\n        // https://github.com/opds-community/drafts/blob/4d82fb9a64f35a174a5f205c23ba623ec010d5ec/schema/publication.schema.json#L78\n        if (!this.Metadata) {\n            console.log(\"OPDSPublication.Metadata is not set!\");\n        }\n        // tslint:disable-next-line:max-line-length\n        // https://github.com/opds-community/drafts/blob/4d82fb9a64f35a174a5f205c23ba623ec010d5ec/schema/publication.schema.json#L79\n        if (!this.Links) {\n            console.log(\"OPDSPublication.Links is not set!\");\n        }\n        // tslint:disable-next-line:max-line-length\n        // https://github.com/opds-community/drafts/blob/4d82fb9a64f35a174a5f205c23ba623ec010d5ec/schema/publication.schema.json#L80\n        if (!this.Images && !this.Image) {\n            console.log(\"OPDSPublication.Image[s] is not set!\");\n        }\n    }\n}\n"]}