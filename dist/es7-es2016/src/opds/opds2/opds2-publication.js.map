{"version":3,"file":"opds2-publication.js","sourceRoot":"","sources":["../../../../../src/opds/opds2/opds2-publication.ts"],"names":[],"mappings":"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","sourcesContent":["// ==LICENSE-BEGIN==\n// Copyright 2017 European Digital Reading Lab. All rights reserved.\n// Licensed to the Readium Foundation under one or more contributor license agreements.\n// Use of this source code is governed by a BSD-style license\n// that can be found in the LICENSE file exposed on Github (readium) in the project repository.\n// ==LICENSE-END==\n\n// https://github.com/edcarroll/ta-json\nimport { JsonElementType, JsonObject, JsonProperty, OnDeserialized } from \"ta-json-x\";\n\nimport { Metadata } from \"@r2-shared-js/models/metadata\";\nimport { BelongsTo } from \"@r2-shared-js/models/metadata-belongsto\";\nimport { Contributor } from \"@r2-shared-js/models/metadata-contributor\";\nimport { Link } from \"@r2-shared-js/models/publication-link\";\n\nimport { OPDSLink } from \"./opds2-link\";\n\n// import { Publication } from \"@r2-shared-js/models/publication\";\n\nconst METADATA_JSON_PROP = \"metadata\";\nconst LINKS_JSON_PROP = \"links\";\nconst IMAGES_JSON_PROP = \"images\";\n\n// tslint:disable-next-line:max-line-length\n// https://github.com/opds-community/drafts/blob/4d82fb9a64f35a174a5f205c23ba623ec010d5ec/schema/publication.schema.json\n@JsonObject()\nexport class OPDSPublication { // extends Publication\n\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/opds-community/drafts/blob/4d82fb9a64f35a174a5f205c23ba623ec010d5ec/schema/publication.schema.json#L7\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/readium/webpub-manifest/blob/0ac78ab5c270a608c39b4b04fc90bd9b1d281896/schema/publication.schema.json#L13\n    @JsonProperty(METADATA_JSON_PROP)\n    public Metadata!: Metadata;\n\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/opds-community/drafts/blob/4d82fb9a64f35a174a5f205c23ba623ec010d5ec/schema/publication.schema.json#L10\n    @JsonProperty(LINKS_JSON_PROP)\n    @JsonElementType(OPDSLink)\n    public Links!: OPDSLink[];\n\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/opds-community/drafts/blob/4d82fb9a64f35a174a5f205c23ba623ec010d5ec/schema/publication.schema.json#L52\n    @JsonProperty(IMAGES_JSON_PROP)\n    @JsonElementType(Link)\n    public Images!: Link[];\n\n    public findFirstLinkByRel(rel: string): OPDSLink | undefined {\n\n        return this.Links ? this.Links.find((l) => {\n            return l.HasRel(rel);\n        }) : undefined;\n    }\n\n    public AddImage(href: string, typeImage: string, height: number, width: number) {\n        const i = new Link();\n\n        i.Href = href;\n        i.TypeLink = typeImage;\n        if (height) {\n            i.Height = height;\n        }\n        if (width) {\n            i.Width = width;\n        }\n\n        if (!this.Images) {\n            this.Images = [];\n        }\n        this.Images.push(i);\n    }\n\n    public AddLink_(href: string, typeLink: string, rel: string, title: string) {\n        const l = new OPDSLink();\n        l.Href = href;\n        l.TypeLink = typeLink;\n        if (rel) {\n            l.AddRel(rel);\n        }\n        if (title) {\n            l.Title = title;\n        }\n\n        if (!this.Links) {\n            this.Links = [];\n        }\n        this.Links.push(l);\n    }\n\n    public AddAuthor(name: string, identifier: string, sortAs: string, href: string, typeLink: string) {\n        const c = new Contributor();\n        c.Name = name;\n        if (identifier) {\n            c.Identifier = identifier;\n        }\n        if (sortAs) {\n            c.SortAs = sortAs;\n        }\n\n        const l = new Link();\n        if (href) {\n            l.Href = href;\n        }\n        if (typeLink) {\n            l.TypeLink = typeLink;\n        }\n\n        if (href) {\n            c.Links = [];\n            c.Links.push(l);\n        }\n\n        if (!this.Metadata) {\n            this.Metadata = new Metadata();\n        }\n        if (!this.Metadata.Author) {\n            this.Metadata.Author = [];\n        }\n        this.Metadata.Author.push(c);\n    }\n\n    public AddSerie(name: string, position: number, href: string, typeLink: string) {\n\n        const c = new Contributor();\n        c.Name = name;\n        c.Position = position;\n\n        const l = new Link();\n        if (href) {\n            l.Href = href;\n        }\n        if (typeLink) {\n            l.TypeLink = typeLink;\n        }\n\n        if (href) {\n            c.Links = [];\n            c.Links.push(l);\n        }\n\n        if (!this.Metadata) {\n            this.Metadata = new Metadata();\n        }\n        if (!this.Metadata.BelongsTo) {\n            this.Metadata.BelongsTo = new BelongsTo();\n        }\n        if (!this.Metadata.BelongsTo.Series) {\n            this.Metadata.BelongsTo.Series = [];\n        }\n\n        this.Metadata.BelongsTo.Series.push(c);\n    }\n\n    public AddPublisher(name: string, href: string, typeLink: string) {\n        const c = new Contributor();\n        c.Name = name;\n\n        const l = new Link();\n        if (href) {\n            l.Href = href;\n        }\n        if (typeLink) {\n            l.TypeLink = typeLink;\n        }\n\n        if (href) {\n            c.Links = [];\n            c.Links.push(l);\n        }\n\n        if (!this.Metadata) {\n            this.Metadata = new Metadata();\n        }\n        if (!this.Metadata.Publisher) {\n            this.Metadata.Publisher = [];\n        }\n        this.Metadata.Publisher.push(c);\n    }\n\n    @OnDeserialized()\n    // tslint:disable-next-line:no-unused-variable\n    // @ts-ignore: TS6133 (is declared but its value is never read.)\n    protected _OnDeserialized() {\n        // tslint:disable-next-line:max-line-length\n        // https://github.com/opds-community/drafts/blob/4d82fb9a64f35a174a5f205c23ba623ec010d5ec/schema/publication.schema.json#L78\n        if (!this.Metadata) {\n            console.log(\"OPDSPublication.Metadata is not set!\");\n        }\n        // tslint:disable-next-line:max-line-length\n        // https://github.com/opds-community/drafts/blob/4d82fb9a64f35a174a5f205c23ba623ec010d5ec/schema/publication.schema.json#L79\n        if (!this.Links) {\n            console.log(\"OPDSPublication.Links is not set!\");\n        }\n        // tslint:disable-next-line:max-line-length\n        // https://github.com/opds-community/drafts/blob/4d82fb9a64f35a174a5f205c23ba623ec010d5ec/schema/publication.schema.json#L80\n        if (!this.Images) {\n            console.log(\"OPDSPublication.Images is not set!\");\n        }\n    }\n}\n"]}