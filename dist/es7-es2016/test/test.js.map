{"version":3,"file":"test.js","sourceRoot":"","sources":["../../../test/test.ts"],"names":[],"mappings":"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","sourcesContent":["import test, { ExecutionContext } from \"ava\";\nimport * as debug_ from \"debug\";\nimport * as http from \"http\";\nimport * as https from \"https\";\nimport * as jsonDiff from \"json-diff\";\nimport { URL } from \"url\";\nimport * as xmldom from \"@xmldom/xmldom\";\n\nimport { TaJsonDeserialize, TaJsonSerialize } from \"@r2-lcp-js/serializable\";\nimport { Publication } from \"@r2-shared-js/models/publication\";\nimport { sortObject, traverseJsonObjects } from \"@r2-utils-js/_utils/JsonUtils\";\nimport { XML } from \"@r2-utils-js/_utils/xml-js-mapper\";\n\nimport {\n    convertOpds1ToOpds2,\n    convertOpds1ToOpds2_EntryToPublication,\n    unescapeHtmlEntities,\n} from \"../src/opds/converter\";\nimport { initGlobalConverters_GENERIC, initGlobalConverters_OPDS } from \"../src/opds/init-globals\";\nimport { OPDS } from \"../src/opds/opds1/opds\";\nimport { Entry } from \"../src/opds/opds1/opds-entry\";\nimport { OPDSFeed } from \"../src/opds/opds2/opds2\";\nimport { OPDSAuthenticationDoc } from \"../src/opds/opds2/opds2-authentication-doc\";\nimport { OPDSPublication } from \"../src/opds/opds2/opds2-publication\";\n\ninitGlobalConverters_OPDS();\ninitGlobalConverters_GENERIC();\n\nconst debug = debug_(\"r2:opds#test\");\n\n// Note to run single test on the command line interface:\n// npm run test -- --match=\"XXX\"\n\n// ==========================\nconst plainTextWithEscapedHtmlChars = `\n\nThis &amp; is &#039;a&quot;        test\n\\tof &lt; summary text &gt;\n\n`;\n\nconst xhtmlWithSomeEscapedHtmlCharsPrefixedNamespace = `\n<xhtm:div>\n    Hello &amp;\\t<xhtm:b>  world &lt; &quot;_&#039; &gt;  </xhtm:b>!\n</xhtm:div>\n`;\n\nconst xhtmlWithSomeEscapedHtmlCharsNoPrefixedNamespace = `\n<div xmlns=\"http://www.w3.org/1999/xhtml\">\n    Hi &amp;\\t<b>  world &lt; &quot;_&#039; &gt;  </b>!\n</div>\n`;\n\nconst xmlWithSomeEscapedHtmlCharsAtomDefaultNamespace = `\n<div>\n    Oops &amp;\\t<b>  world &lt; &quot;_&#039; &gt;  </b>!\n</div>\n`;\n\nconst escapedHtmlWithSomeDoubleEscapedHtmlChars = `\n&lt;div&gt;\n    Hello &amp;amp;\\t&lt;b&gt;  world &amp;lt; &amp;quot;_&amp;#039; &amp;gt;  &lt;/b&gt;!\n&lt;/div&gt;\n`;\n\ntest(\"OPDS1-2 description: summary + content(XHTML NAMESPACE PREFIX)\", async (t) => {\n    const xmlSrc = `\n<entry\n    xmlns=\"http://www.w3.org/2005/Atom\"\n    xmlns:xhtm=\"http://www.w3.org/1999/xhtml\">\n<summary>${plainTextWithEscapedHtmlChars}</summary>\n<content type=\"xhtml\">${xhtmlWithSomeEscapedHtmlCharsPrefixedNamespace}</content>\n</entry>\n    `;\n    const xmlDom = new xmldom.DOMParser().parseFromString(xmlSrc); // , \"application/xml\"\n    const isEntry = xmlDom.documentElement.localName === \"entry\";\n    t.true(isEntry);\n    const opds1Entry = XML.deserialize<Entry>(xmlDom, Entry);\n    t.is(\n        // ALREADY UNESCAPED BY THE XPATH text() selector\n        // e.g. @XmlXPathSelector(\"atom:content/text()\")\n        opds1Entry.Summary,\n        unescapeHtmlEntities(plainTextWithEscapedHtmlChars),\n    );\n\n    // CHILD(REN) XML NODES ALREADY SERIALIZED (INC. NAMESPACES) BY THE XPATH text() selector\n    // e.g. @XmlXPathSelector(\"atom:content/text()\")\n    // ... BUT ONLY \"ESSENTIAL\" ESCAPED (&amp; and &lt;)\n    const toMatch = xhtmlWithSomeEscapedHtmlCharsPrefixedNamespace\n        // .replace(/&lt;/g, \"<\") // &#60;\n        .replace(/&gt;/g, \">\") // &#62;\n        // eslint-disable-next-line prettier/prettier\n        .replace(/&quot;/g, \"\\\"\") // &#34;\n        .replace(/&#039;/g, \"'\"); // &apos;\n    // .replace(/&apos;/g, \"'\") // xhtml, not html\n    // .replace(/&amp;/g, \"&\") // &#38;\n    t.is(opds1Entry.Content.replace(/ xmlns:xhtm=\"http:\\/\\/www\\.w3\\.org\\/1999\\/xhtml\"/, \"\"), toMatch);\n    const opds2Pub = convertOpds1ToOpds2_EntryToPublication(opds1Entry);\n    t.is(opds2Pub.Metadata.Description.replace(/ xmlns:xhtm=\"http:\\/\\/www\\.w3\\.org\\/1999\\/xhtml\"/, \"\"), toMatch);\n});\n\ntest(\"OPDS1-2 description: summary + content(XHTML NAMESPACE NO PREFIX)\", async (t) => {\n    const xmlSrc = `\n<entry\n    xmlns=\"http://www.w3.org/2005/Atom\"\n    xmlns:xhtm=\"http://www.w3.org/1999/xhtml\">\n<summary>${plainTextWithEscapedHtmlChars}</summary>\n<content type=\"xhtml\">${xhtmlWithSomeEscapedHtmlCharsNoPrefixedNamespace}</content>\n</entry>\n    `;\n    const xmlDom = new xmldom.DOMParser().parseFromString(xmlSrc); // , \"application/xml\"\n    const isEntry = xmlDom.documentElement.localName === \"entry\";\n    t.true(isEntry);\n    const opds1Entry = XML.deserialize<Entry>(xmlDom, Entry);\n    t.is(\n        // ALREADY UNESCAPED BY THE XPATH text() selector\n        // e.g. @XmlXPathSelector(\"atom:content/text()\")\n        opds1Entry.Summary,\n        unescapeHtmlEntities(plainTextWithEscapedHtmlChars),\n    );\n\n    // CHILD(REN) XML NODES ALREADY SERIALIZED (INC. NAMESPACES) BY THE XPATH text() selector\n    // e.g. @XmlXPathSelector(\"atom:content/text()\")\n    // ... BUT ONLY \"ESSENTIAL\" ESCAPED (&amp; and &lt;)\n    const toMatch = xhtmlWithSomeEscapedHtmlCharsNoPrefixedNamespace\n        // .replace(/&lt;/g, \"<\") // &#60;\n        .replace(/&gt;/g, \">\") // &#62;\n        // eslint-disable-next-line prettier/prettier\n        .replace(/&quot;/g, \"\\\"\") // &#34;\n        .replace(/&#039;/g, \"'\"); // &apos;\n    // .replace(/&apos;/g, \"'\") // xhtml, not html\n    // .replace(/&amp;/g, \"&\") // &#38;\n    t.is(opds1Entry.Content, toMatch);\n    const opds2Pub = convertOpds1ToOpds2_EntryToPublication(opds1Entry);\n    t.is(opds2Pub.Metadata.Description, toMatch);\n});\n\ntest(\"OPDS1-2 description: summary + content(XML DEFAULT ATOM NAMESPACE)\", async (t) => {\n    const xmlSrc = `\n<entry\n    xmlns=\"http://www.w3.org/2005/Atom\"\n    xmlns:xhtm=\"http://www.w3.org/1999/xhtml\">\n<summary>${plainTextWithEscapedHtmlChars}</summary>\n<content type=\"xhtml\">${xmlWithSomeEscapedHtmlCharsAtomDefaultNamespace}</content>\n</entry>\n    `;\n    const xmlDom = new xmldom.DOMParser().parseFromString(xmlSrc); // , \"application/xml\"\n    const isEntry = xmlDom.documentElement.localName === \"entry\";\n    t.true(isEntry);\n    const opds1Entry = XML.deserialize<Entry>(xmlDom, Entry);\n    t.is(\n        // ALREADY UNESCAPED BY THE XPATH text() selector\n        // e.g. @XmlXPathSelector(\"atom:content/text()\")\n        opds1Entry.Summary,\n        unescapeHtmlEntities(plainTextWithEscapedHtmlChars),\n    );\n\n    // CHILD(REN) XML NODES ALREADY SERIALIZED (INC. NAMESPACES) BY THE XPATH text() selector\n    // e.g. @XmlXPathSelector(\"atom:content/text()\")\n    // ... BUT ONLY \"ESSENTIAL\" ESCAPED (&amp; and &lt;)\n    const toMatch = xmlWithSomeEscapedHtmlCharsAtomDefaultNamespace\n        // .replace(/&lt;/g, \"<\") // &#60;\n        .replace(/&gt;/g, \">\") // &#62;\n        // eslint-disable-next-line prettier/prettier\n        .replace(/&quot;/g, \"\\\"\") // &#34;\n        .replace(/&#039;/g, \"'\"); // &apos;\n    // .replace(/&apos;/g, \"'\") // xhtml, not html\n    // .replace(/&amp;/g, \"&\") // &#38;\n    t.is(opds1Entry.Content.replace(/ xmlns=\"http:\\/\\/www\\.w3\\.org\\/2005\\/Atom\"/, \"\"), toMatch);\n    const opds2Pub = convertOpds1ToOpds2_EntryToPublication(opds1Entry);\n    t.is(opds2Pub.Metadata.Description.replace(/ xmlns=\"http:\\/\\/www\\.w3\\.org\\/1999\\/xhtml\"/, \"\"), toMatch);\n});\n\ntest(\"OPDS1-2 description: summary\", async (t) => {\n    const xmlSrc = `\n<entry\n    xmlns=\"http://www.w3.org/2005/Atom\"\n    xmlns:xhtm=\"http://www.w3.org/1999/xhtml\">\n<summary>${plainTextWithEscapedHtmlChars}</summary>\n</entry>\n    `;\n    const xmlDom = new xmldom.DOMParser().parseFromString(xmlSrc); // , \"application/xml\"\n    const isEntry = xmlDom.documentElement.localName === \"entry\";\n    t.true(isEntry);\n    const opds1Entry = XML.deserialize<Entry>(xmlDom, Entry);\n    const toMatch = unescapeHtmlEntities(plainTextWithEscapedHtmlChars);\n    t.is(\n        // ALREADY UNESCAPED BY THE XPATH text() selector\n        // e.g. @XmlXPathSelector(\"atom:content/text()\")\n        opds1Entry.Summary,\n        toMatch,\n    );\n    const opds2Pub = convertOpds1ToOpds2_EntryToPublication(opds1Entry);\n    t.is(opds2Pub.Metadata.Description, toMatch);\n});\ntest(\"OPDS1-2 description: summary + content(HTML)\", async (t) => {\n    const xmlSrc = `\n<entry\n    xmlns=\"http://www.w3.org/2005/Atom\"\n    xmlns:xhtm=\"http://www.w3.org/1999/xhtml\">\n<summary>${plainTextWithEscapedHtmlChars}</summary>\n<content type=\"html\">${escapedHtmlWithSomeDoubleEscapedHtmlChars}</content>\n</entry>\n    `;\n    const xmlDom = new xmldom.DOMParser().parseFromString(xmlSrc); // , \"application/xml\"\n    const isEntry = xmlDom.documentElement.localName === \"entry\";\n    t.true(isEntry);\n    const opds1Entry = XML.deserialize<Entry>(xmlDom, Entry);\n    t.is(\n        // ALREADY UNESCAPED BY THE XPATH text() selector\n        // e.g. @XmlXPathSelector(\"atom:content/text()\")\n        opds1Entry.Summary,\n        unescapeHtmlEntities(plainTextWithEscapedHtmlChars),\n    );\n\n    // ALREADY UNESCAPED BY THE XPATH text() selector\n    // e.g. @XmlXPathSelector(\"atom:content/text()\")\n    const toMatch = unescapeHtmlEntities(escapedHtmlWithSomeDoubleEscapedHtmlChars);\n    t.is(opds1Entry.Content, toMatch);\n    const opds2Pub = convertOpds1ToOpds2_EntryToPublication(opds1Entry);\n    t.is(opds2Pub.Metadata.Description, toMatch);\n});\n\nasync function fn() {\n    return Promise.resolve(\"foo\");\n}\ntest(\"dummy async test\", async (t) => {\n    debug(\"test ASYNC\");\n    t.is(await fn(), \"foo\");\n});\n\nconst MAX_TESTS = process.env.MAX_TESTS || 10;\n\nconst FEEDS_FIRST = process.env.FEEDS_FIRST || false;\n\ninterface OPDSFeedAndPubUrls {\n    feeds: Set<string>;\n    pubs: Set<string>;\n    audiowebpubs: Set<string>;\n    webpubs: Set<string>;\n    authentications: Set<string>;\n}\n\nasync function delay(okay: boolean): Promise<boolean> {\n    return new Promise((resolve, _reject) => {\n        setTimeout(() => {\n            resolve(okay);\n        }, 1000);\n    });\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nasync function parseCompareJSONs(url: string, json1: any, json2: any): Promise<OPDSFeedAndPubUrls> {\n    return new Promise<OPDSFeedAndPubUrls>((resolve, reject) => {\n        if (json1 !== json2) {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            const harmonizeNulls = (obj: any) => {\n                if (obj !== null && typeof obj !== \"undefined\") {\n                    if (obj instanceof Array) {\n                        for (let i = obj.length - 1; i >= 0; i--) {\n                            if (obj[i] === null) {\n                                obj.splice(i, 1);\n                            }\n                        }\n                    } else if (typeof obj === \"object\") {\n                        Object.keys(obj).forEach((key) => {\n                            if (obj[key] === null) {\n                                delete obj[key];\n                            }\n                        });\n                    }\n                }\n            };\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            const harmonizeBitrateAndTrack = (obj: any) => {\n                if (typeof obj.bitrate === \"string\") {\n                    obj.bitrate = parseFloat(obj.bitrate);\n                }\n                if (typeof obj.tracks === \"number\") {\n                    delete obj.tracks;\n                }\n            };\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            const harmonizeDate = (obj: any) => {\n                [\"updated\", \"published\", \"since\", \"until\", \"modified\"].forEach((term) => {\n                    if (obj[term]) {\n                        if (typeof obj[term] === \"string\" || typeof obj[term] === \"number\") {\n                            const date = new Date(obj[term] as string);\n                            const time = date.getTime();\n                            if (!isNaN(time)) {\n                                const tmp = date.toISOString();\n                                if (obj[term] !== tmp) {\n                                    // console.log(\"=== \" + term + \": \" + obj[term] + \" => \" + tmp);\n                                    obj[term] = tmp;\n                                }\n                            } else {\n                                console.log(\"TIME? \" + time);\n                            }\n                        }\n                    }\n                });\n            };\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            const harmonizeName = (obj: any) => {\n                // tslint:disable-next-line:max-line-length\n                [\n                    \"subject\",\n                    \"collection\",\n                    \"series\",\n                    \"author\",\n                    \"translator\",\n                    \"editor\",\n                    \"artist\",\n                    \"illustrator\",\n                    \"letterer\",\n                    \"penciler\",\n                    \"colorist\",\n                    \"inker\",\n                    \"narrator\",\n                    \"contributor\",\n                    \"publisher\",\n                    \"imprint\",\n                ].forEach((term) => {\n                    if (obj[term]) {\n                        const isArray = obj[term] instanceof Array;\n                        const arr = isArray ? obj[term] : [obj[term]];\n                        // tslint:disable-next-line:prefer-for-of\n                        for (let i = 0; i < arr.length; i++) {\n                            if (typeof arr[i] === \"string\") {\n                                // console.log(\"string to name object => \" + term + \": \" + arr[i]);\n                                if (isArray) {\n                                    obj[term][i] = { name: obj[term][i] };\n                                } else {\n                                    obj[term] = { name: obj[term] };\n                                }\n                            } else if (typeof arr[i] === \"object\") {\n                                if (arr[i].name) {\n                                    if (typeof arr[i].name === \"string\") {\n                                        // // console.log(\"name string in object to lang map => \" +\n                                        // // term + \": \" + arr[i].name);\n                                        // if (isArray) {\n                                        //     obj[term][i].name = { _: obj[term][i].name };\n                                        // } else {\n                                        //     obj[term].name = { _: obj[term].name };\n                                        // }\n                                        // do nothing\n                                    } else if (typeof arr[i].name === \"object\") {\n                                        // IStringMap\n                                        // do nothing\n                                    }\n                                }\n                            }\n                        }\n                        if (!isArray) {\n                            obj[term] = [obj[term]];\n                        }\n                    }\n                });\n            };\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            const harmonizeArrays = (obj: any) => {\n                // tslint:disable-next-line:max-line-length\n                [\"role\", \"@context\", \"rel\", \"language\"].forEach((term) => {\n                    if (obj[term]) {\n                        const isArray = obj[term] instanceof Array;\n                        if (!isArray) {\n                            obj[term] = [obj[term]];\n                        }\n                    }\n                });\n            };\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            // const harmonizeFieldnames = (obj: any) => {\n            //     if (obj.belongs_to) {\n            //         obj.belongsTo = obj.belongs_to;\n            //         obj.belongs_to = undefined;\n            //         delete obj.belongs_to;\n            //     }\n            //     if (obj.sort_as) {\n            //         obj.sortAs = obj.sort_as;\n            //         obj.sort_as = undefined;\n            //         delete obj.sort_as;\n            //     }\n            //     if (obj.direction) {\n            //         obj.readingProgression = obj.direction;\n            //         obj.direction = undefined;\n            //         delete obj.direction;\n            //     }\n            //     if (obj.spine) {\n            //         obj.readingOrder = obj.spine;\n            //         obj.spine = undefined;\n            //         delete obj.spine;\n            //     }\n            // };\n\n            // debug(json2);\n            // debug(\"------------------------\");\n            // debug(\"------------------------\");\n\n            // console.log(\"=== HARMONIZING JSON1 ...\");\n            traverseJsonObjects(json1, (obj) => {\n                if (obj !== null) {\n                    harmonizeDate(obj);\n                }\n            });\n            traverseJsonObjects(json1, (obj) => {\n                if (obj !== null) {\n                    harmonizeName(obj);\n                }\n            });\n            traverseJsonObjects(json1, (obj) => {\n                if (obj !== null) {\n                    harmonizeArrays(obj);\n                }\n            });\n            traverseJsonObjects(json1, (obj) => {\n                if (obj !== null) {\n                    harmonizeBitrateAndTrack(obj);\n                }\n            });\n            traverseJsonObjects(json1, (obj) => {\n                if (obj !== null) {\n                    harmonizeNulls(obj);\n                }\n            });\n            // console.log(\"=== HARMONIZING JSON2 ...\");\n            traverseJsonObjects(json2, (obj) => {\n                if (obj !== null) {\n                    harmonizeDate(obj);\n                }\n            });\n            traverseJsonObjects(json2, (obj) => {\n                if (obj !== null) {\n                    harmonizeName(obj);\n                }\n            });\n            traverseJsonObjects(json2, (obj) => {\n                if (obj !== null) {\n                    harmonizeArrays(obj);\n                }\n            });\n            traverseJsonObjects(json2, (obj) => {\n                if (obj !== null) {\n                    harmonizeBitrateAndTrack(obj);\n                }\n            });\n            traverseJsonObjects(json2, (obj) => {\n                if (obj !== null) {\n                    harmonizeNulls(obj);\n                }\n            });\n            json1 = sortObject(json1);\n            json2 = sortObject(json2);\n\n            const str1 = JSON.stringify(json1, null, 2);\n            const str2 = JSON.stringify(json2, null, 2);\n\n            if (str1 !== str2) {\n                process.stdout.write(\"###########################\\n\");\n                process.stdout.write(\"###########################\\n\");\n                process.stdout.write(\"#### JSON DIFF\\n\");\n                process.stdout.write(jsonDiff.diffString(json1, json2) + \"\\n\");\n                // process.stdout.write(\"###########################\\n\");\n                // process.stdout.write(\"###########################\\n\");\n                // process.stdout.write(jsonDiff.diffString(opds2Json, json) + \"\\n\");\n                process.stdout.write(\"###########################\\n\");\n                process.stdout.write(\"###########################\\n\");\n                // console.log(jsonDiff.diff(json, opds2Json));\n\n                reject(\"JSON DIFF! :(\");\n                return;\n            }\n        }\n\n        const thisUrl = new URL(url);\n        const thisUrlStr = thisUrl.toString();\n        const feedUrls = new Set<string>();\n        const pubUrls = new Set<string>();\n        const webpubUrls = new Set<string>();\n        const audiowebpubUrls = new Set<string>();\n        const authenticationUrls = new Set<string>();\n\n        traverseJsonObjects(json1, (obj) => {\n            if (obj === null) {\n                return; // skip\n            }\n            const isFeed = obj.type === \"application/opds+json\";\n            const isPub = obj.type === \"application/opds-publication+json\";\n            const isWebPubManifestAudio = obj.type === \"application/audiobook+json\";\n            const isAuth = obj.type === \"application/vnd.opds.authentication.v1.0+json\";\n\n            // to skip erroneous feed (dirty detection, but will do for these tests)\n            const isWebPubManifest =\n                obj.type === \"application/webpub+json\" && obj.href && obj.href.indexOf(\".epub\") < 0;\n\n            if (obj.href && (isFeed || isPub || isWebPubManifest || isWebPubManifestAudio || isAuth)) {\n                const u = new URL(obj.href, thisUrl);\n                const uStr = u.toString();\n                if (uStr !== thisUrlStr) {\n                    if (isFeed) {\n                        feedUrls.add(uStr);\n                    } else if (isPub) {\n                        pubUrls.add(uStr);\n                    } else if (isWebPubManifest) {\n                        webpubUrls.add(uStr);\n                    } else if (isWebPubManifestAudio) {\n                        audiowebpubUrls.add(uStr);\n                    } else if (isAuth) {\n                        authenticationUrls.add(uStr);\n                    }\n\n                    // console.log(\"URL: \" + obj.href + \" => \" + uStr);\n                } else {\n                    // console.log(\"URL: \" + obj.href + \" (skipped)\");\n                }\n            }\n        });\n\n        const set: OPDSFeedAndPubUrls = {\n            audiowebpubs: audiowebpubUrls,\n            authentications: authenticationUrls,\n            feeds: feedUrls,\n            pubs: pubUrls,\n            webpubs: webpubUrls,\n        };\n        resolve(set);\n    });\n}\n\nasync function opds2Test(url: string): Promise<OPDSFeedAndPubUrls> {\n    return new Promise<OPDSFeedAndPubUrls>((resolve, reject) => {\n        // debug(\"------------------------\");\n        debug(url);\n        // debug(\"------------------------\");\n\n        const proto = /^https:\\/\\//.test(url) ? https : http;\n        proto\n            .get(url, (response) => {\n                let str: string | undefined;\n                let buffs: Buffer[] | undefined;\n\n                if (response.statusCode && (response.statusCode < 200 || response.statusCode >= 300)) {\n                    debug(`${url} ==> ${response.statusCode} (skipped)`);\n                    const empty: OPDSFeedAndPubUrls = {\n                        audiowebpubs: new Set<string>([]),\n                        authentications: new Set<string>([]),\n                        feeds: new Set<string>([]),\n                        pubs: new Set<string>([]),\n                        webpubs: new Set<string>([]),\n                    };\n                    resolve(empty);\n                    return;\n                }\n\n                response.on(\"data\", (chunk) => {\n                    if (typeof chunk === \"string\") {\n                        if (!str) {\n                            str = \"\";\n                        }\n                        str += chunk;\n                    } else {\n                        if (!buffs) {\n                            buffs = [];\n                        }\n                        buffs.push(chunk);\n                    }\n                });\n\n                response.on(\"end\", async () => {\n                    let src: string | undefined;\n                    if (str) {\n                        src = str;\n                    } else if (buffs) {\n                        src = Buffer.concat(buffs).toString(\"utf8\");\n                    }\n                    if (!src) {\n                        reject(`Problem loading: ${url}`);\n                        return;\n                    }\n\n                    const json1 = JSON.parse(src);\n                    // traverseJsonObjects(json1,\n                    //     (obj) => {\n                    //         harmonizeFieldnames(obj);\n                    //     });\n                    // debug(json1);\n                    // debug(\"------------------------\");\n                    // debug(\"------------------------\");\n                    const isPublication =\n                        !json1.publications && !json1.navigation && !json1.groups && !json1.catalogs && json1.metadata;\n                    const isAuth = !isPublication && json1.authentication;\n\n                    const opds2Feed: OPDSPublication | OPDSFeed | OPDSAuthenticationDoc =\n                        // tslint:disable-next-line: max-line-length\n                        isPublication\n                            ? TaJsonDeserialize<OPDSPublication>(json1, OPDSPublication) // \"application/opds-publication+json\"\n                            : // tslint:disable-next-line: max-line-length\n                            isAuth\n                            ? TaJsonDeserialize<OPDSAuthenticationDoc>(json1, OPDSAuthenticationDoc) // \"application/vnd.opds.authentication.v1.0+json\"\n                            : TaJsonDeserialize<OPDSFeed>(json1, OPDSFeed); // \"application/opds+json\"\n                    // debug(opds2Feed);\n                    // debug(\"------------------------\");\n                    // debug(\"------------------------\");\n\n                    // if (isPublication) { // OPDSPublication is not IWithAdditionalJSON\n                    //     const pub = opds2Feed as OPDSPublication;\n                    // } else if (isAuth) { // OPDSAuthenticationDoc\n                    //     const authDoc = opds2Feed as IWithAdditionalJSON;\n                    //     if (authDoc.AdditionalJSON) {\n                    //         Object.keys(authDoc.AdditionalJSON).forEach((key) => {\n                    //             if (authDoc.AdditionalJSON.hasOwnProperty(key)) {\n                    //                 (authDoc as any)[key] = authDoc.AdditionalJSON[key];\n                    //                 delete authDoc.AdditionalJSON[key];\n                    //             }\n                    //         });\n                    //         debug(authDoc);\n                    //         debug(authDoc.AdditionalJSON);\n                    //     }\n                    // } else { // OPDSFeed is not IWithAdditionalJSON\n                    //     const feed = opds2Feed as OPDSFeed;\n                    // }\n\n                    const json2 = TaJsonSerialize(opds2Feed);\n\n                    let res: OPDSFeedAndPubUrls | undefined;\n                    try {\n                        res = await parseCompareJSONs(url, json1, json2);\n                    } catch (err) {\n                        debug(err);\n                        reject(err);\n                        return;\n                    }\n                    resolve(res);\n                });\n            })\n            .on(\"error\", (err) => {\n                reject(err);\n            });\n    });\n}\n\nasync function webpubTest(url: string, alreadyDone: Set<string>): Promise<boolean> {\n    alreadyDone.add(url);\n\n    return new Promise((resolve, reject) => {\n        // debug(\"------------------------\");\n        debug(url);\n        // debug(\"------------------------\");\n\n        const proto = /^https:\\/\\//.test(url) ? https : http;\n        proto\n            .get(url, (response) => {\n                let str: string | undefined;\n                let buffs: Buffer[] | undefined;\n\n                if (response.statusCode && (response.statusCode < 200 || response.statusCode >= 300)) {\n                    debug(`${url} ==> ${response.statusCode} (skipped)`);\n                    resolve(true);\n                    return;\n                }\n\n                response.on(\"data\", (chunk) => {\n                    if (typeof chunk === \"string\") {\n                        if (!str) {\n                            str = \"\";\n                        }\n                        str += chunk;\n                    } else {\n                        if (!buffs) {\n                            buffs = [];\n                        }\n                        buffs.push(chunk);\n                    }\n                });\n\n                response.on(\"end\", async () => {\n                    let src: string | undefined;\n                    if (str) {\n                        src = str;\n                    } else if (buffs) {\n                        src = Buffer.concat(buffs).toString(\"utf8\");\n                    }\n                    if (!src) {\n                        reject(`Problem loading: ${url}`);\n                        return;\n                    }\n                    // debug(src);\n\n                    const json1 = JSON.parse(src);\n                    // debug(json1);\n\n                    let pub: Publication | undefined;\n                    try {\n                        pub = TaJsonDeserialize<Publication>(json1, Publication);\n                    } catch (err) {\n                        debug(err);\n                        reject(err);\n                        return;\n                    }\n\n                    // debug(pub);\n                    const json2 = TaJsonSerialize(pub);\n\n                    // let res: OPDSFeedAndPubUrls | undefined;\n                    try {\n                        // res =\n                        await parseCompareJSONs(url, json1, json2);\n                    } catch (err) {\n                        debug(err);\n                        reject(err);\n                        return;\n                    }\n\n                    // debug(res); // we could recurse again on pub links ...\n                    resolve(true);\n                });\n            })\n            .on(\"error\", (err) => {\n                reject(err);\n            });\n    });\n}\n\nasync function recursePubs(t: ExecutionContext, urls: OPDSFeedAndPubUrls, alreadyDone: Set<string>): Promise<boolean> {\n    const urlsTodoWebPubs: string[] = [];\n    urls.webpubs.forEach((u) => {\n        if (!alreadyDone.has(u)) {\n            urlsTodoWebPubs.push(u);\n        }\n    });\n\n    for (const href of urlsTodoWebPubs) {\n        try {\n            const okay = await webpubTest(href, alreadyDone);\n            if (!okay) {\n                return false;\n            }\n        } catch (err) {\n            debug(err);\n            // early termination\n            return false;\n        }\n    }\n\n    const urlsTodoAudioWebPubs: string[] = [];\n    urls.audiowebpubs.forEach((u) => {\n        if (!alreadyDone.has(u)) {\n            urlsTodoAudioWebPubs.push(u);\n        }\n    });\n\n    for (const href of urlsTodoAudioWebPubs) {\n        try {\n            const okay = await webpubTest(href, alreadyDone);\n            if (!okay) {\n                return false;\n            }\n        } catch (err) {\n            debug(err);\n            // early termination\n            return false;\n        }\n    }\n\n    const urlsTodoPubs: string[] = [];\n    urls.pubs.forEach((u) => {\n        if (!alreadyDone.has(u)) {\n            urlsTodoPubs.push(u);\n        }\n    });\n\n    for (const href of urlsTodoPubs) {\n        const okay = await testUrl(t, href, alreadyDone);\n        if (!okay) {\n            return false;\n        }\n    }\n\n    const urlsAuths: string[] = [];\n    urls.authentications.forEach((u) => {\n        if (!alreadyDone.has(u)) {\n            urlsAuths.push(u);\n        }\n    });\n\n    for (const href of urlsAuths) {\n        const okay = await testUrl(t, href, alreadyDone);\n        if (!okay) {\n            return false;\n        }\n    }\n\n    return true;\n}\n\n// tslint:disable-next-line:max-line-length\nasync function recurseFeeds(t: ExecutionContext, urls: OPDSFeedAndPubUrls, alreadyDone: Set<string>): Promise<boolean> {\n    const urlsTodoFeeds: string[] = [];\n    urls.feeds.forEach((u) => {\n        if (!alreadyDone.has(u)) {\n            urlsTodoFeeds.push(u);\n        }\n    });\n\n    for (const href of urlsTodoFeeds) {\n        const okay = await testUrl(t, href, alreadyDone);\n        if (!okay) {\n            return false;\n        }\n    }\n\n    return true;\n}\n\nasync function recurse(t: ExecutionContext, urls: OPDSFeedAndPubUrls, alreadyDone: Set<string>): Promise<boolean> {\n    if (FEEDS_FIRST) {\n        const b1 = await recurseFeeds(t, urls, alreadyDone);\n        if (!b1) {\n            return b1;\n        }\n        const b2 = await recursePubs(t, urls, alreadyDone);\n        return b2;\n    }\n\n    const b3 = await recursePubs(t, urls, alreadyDone);\n    if (!b3) {\n        return b3;\n    }\n    const b4 = await recurseFeeds(t, urls, alreadyDone);\n    return b4;\n}\n\nasync function testUrl(t: ExecutionContext, url: string, alreadyDone: Set<string>): Promise<boolean> {\n    if (alreadyDone.size >= MAX_TESTS) {\n        return true;\n    }\n\n    alreadyDone.add(url);\n\n    let urls: OPDSFeedAndPubUrls | undefined;\n    try {\n        urls = await opds2Test(url);\n    } catch (err) {\n        debug(err);\n        // early termination\n        return false;\n    }\n\n    if (urls) {\n        return await recurse(t, urls, alreadyDone);\n    }\n\n    return true;\n}\n\nasync function testUrlAlt(t: ExecutionContext, url: string, alreadyDone: Set<string>): Promise<boolean> {\n    if (alreadyDone.size >= MAX_TESTS) {\n        return true;\n    }\n\n    alreadyDone.add(url);\n\n    const promise = new Promise<boolean>((resolve, reject) => {\n        const proto = /^https:\\/\\//.test(url) ? https : http;\n        proto\n            .get(url, async (response) => {\n                let str: string | undefined;\n                let buffs: Buffer[] | undefined;\n\n                if (response.statusCode && (response.statusCode < 200 || response.statusCode >= 300)) {\n                    debug(`${url} ==> ${response.statusCode} (skipped)`);\n                    resolve(true);\n                    return;\n                }\n\n                response.on(\"data\", (chunk) => {\n                    if (typeof chunk === \"string\") {\n                        if (!str) {\n                            str = \"\";\n                        }\n                        str += chunk;\n                    } else {\n                        if (!buffs) {\n                            buffs = [];\n                        }\n                        buffs.push(chunk);\n                    }\n                });\n\n                response.on(\"end\", async () => {\n                    let src: string | undefined;\n                    if (str) {\n                        src = str;\n                    } else if (buffs) {\n                        src = Buffer.concat(buffs).toString(\"utf8\");\n                    }\n                    if (!src) {\n                        debug(`Problem loading: ${url} (skip)`);\n                        resolve(true);\n                        return;\n                    }\n                    // debug(src);\n\n                    const xmlDom = new xmldom.DOMParser().parseFromString(src);\n                    if (!xmlDom || !xmlDom.documentElement) {\n                        reject(\"Problem parsing OPDS1 XML. Fail.\");\n                        return;\n                    }\n                    const isEntry = xmlDom.documentElement.localName === \"entry\";\n                    if (isEntry) {\n                        debug(\"Expecting OPDS1 Feed, not Entry. Skip.\");\n                        resolve(true);\n                        return;\n                    }\n\n                    const opds1Feed = XML.deserialize<OPDS>(xmlDom, OPDS);\n                    const opds2Feed: OPDSFeed = convertOpds1ToOpds2(opds1Feed);\n                    const opds2FeedJson = TaJsonSerialize(opds2Feed);\n                    // debug(opds2FeedJson);\n\n                    let urls: OPDSFeedAndPubUrls | undefined;\n                    try {\n                        urls = await parseCompareJSONs(url, opds2FeedJson, opds2FeedJson);\n                    } catch (err) {\n                        reject(err);\n                        return;\n                    }\n\n                    if (urls) {\n                        const b = await recurse(t, urls, alreadyDone);\n                        resolve(b);\n                        return;\n                    }\n\n                    resolve(true);\n                    return;\n                });\n            })\n            .on(\"error\", async (err) => {\n                reject(err);\n                return;\n            });\n    });\n    return await promise;\n}\n\nasync function runUrlTest(t: ExecutionContext, url: string) {\n    const done = new Set<string>([]);\n    try {\n        const okay = await testUrl(t, url, done);\n        debug(done);\n        debug(done.size);\n\n        t.true(await delay(okay));\n        return;\n    } catch (err) {\n        debug(err);\n    }\n    t.true(await delay(false));\n}\n\nasync function runUrlTestAlt(t: ExecutionContext, url: string) {\n    const done = new Set<string>([]);\n    try {\n        const okay = await testUrlAlt(t, url, done);\n        debug(done);\n        debug(done.size);\n\n        t.true(await delay(okay));\n        return;\n    } catch (err) {\n        debug(err);\n    }\n    t.true(await delay(false));\n}\n\ntest(\"OPDS2 HTTP (de)serialize roundtrip (recursive) 1\", async (t) => {\n    const url = \"https://test.opds.io/2.0/home.json\";\n    // https://test.opds.io/2.0/navigation.json\n    // https://test.opds.io/2.0/publications.json\n    // https://test.opds.io/2.0/404.json\n    await runUrlTest(t, url);\n});\n\ntest(\"OPDS2 HTTP (de)serialize roundtrip (recursive) 2\", async (t) => {\n    const url = \"https://catalog.feedbooks.com/catalog/public_domain.json\";\n    // https://catalog.feedbooks.com/catalog/index.json\n    // https://catalog.feedbooks.com/book/1421.json\n    await runUrlTest(t, url);\n});\n\ntest(\"OPDS2 HTTP (de)serialize roundtrip (recursive) CATALOGS\", async (t) => {\n    const url = \"https://libraryregistry.librarysimplified.org/libraries\";\n    await runUrlTest(t, url);\n});\n\ntest(\"OPDS2 HTTP (de)serialize roundtrip (recursive) AUTHENTICATION\", async (t) => {\n    const url = \"http://acl.simplye-ca.org/CALMDA/authentication_document\";\n    await runUrlTest(t, url);\n});\n\ntest(\"OPDS1-2 HTTP convert (de)serialize roundtrip (recursive)\", async (t) => {\n    const url = \"https://bookserver.archive.org/group/openaudiobooks\";\n    await runUrlTestAlt(t, url);\n});\n\ntest(\"test\", async (t) => {\n    const url = \"https://api.archivelab.org/books/bookconcord_preface_1202/opds_audio_manifest\";\n    const done = new Set<string>([]);\n    await webpubTest(url, done);\n    debug(done);\n    debug(done.size);\n    t.true(await delay(true));\n});\n\ntest(\"OPDS1-2 LCP passphrase convert (de)serialize roundtrip\", async (t) => {\n    const xmlSrc = `\n<entry\n    xmlns=\"http://www.w3.org/2005/Atom\"\n    xmlns:lcp=\"http://readium.org/lcp-specs/ns\">\n\n    <link\n        rel=\"http://opds-spec.org/acquisition/\"\n        href=\"FAKE_URL\"\n        type=\"application/vnd.readium.lcp.license.v1.0+json\">\n\n        <lcp:hashed_passphrase>FAKE_BASE64</lcp:hashed_passphrase>\n    </link>\n</entry>\n    `;\n    const xmlDom = new xmldom.DOMParser().parseFromString(xmlSrc);\n    const isEntry = xmlDom.documentElement.localName === \"entry\";\n    t.true(isEntry);\n    const opds1Entry = XML.deserialize<Entry>(xmlDom, Entry);\n    t.is(opds1Entry.Links[0].LcpHashedPassphrase, \"FAKE_BASE64\");\n    const opds2Pub = convertOpds1ToOpds2_EntryToPublication(opds1Entry);\n    t.is(opds2Pub.Links[0].Properties.AdditionalJSON.lcp_hashed_passphrase, \"FAKE_BASE64\");\n    const opds2PubJson = TaJsonSerialize(opds2Pub);\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any,@typescript-eslint/ban-types\n    t.is((((opds2PubJson.links as [{}])[0] as any).properties as any).lcp_hashed_passphrase as string, \"FAKE_BASE64\");\n});\n"]}