{"version":3,"file":"opds2.js","sourceRoot":"","sources":["../../../../../src/opds/opds2/opds2.ts"],"names":[],"mappings":"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","sourcesContent":["// ==LICENSE-BEGIN==\n// Copyright 2017 European Digital Reading Lab. All rights reserved.\n// Licensed to the Readium Foundation under one or more contributor license agreements.\n// Use of this source code is governed by a BSD-style license\n// that can be found in the LICENSE file exposed on Github (readium) in the project repository.\n// ==LICENSE-END==\n\n// https://github.com/edcarroll/ta-json\nimport {\n    JsonConverter, JsonElementType, JsonObject, JsonProperty, OnDeserialized,\n} from \"ta-json-x\";\n\nimport { JsonStringConverter } from \"@r2-utils-js/_utils/ta-json-string-converter\";\n\nimport { OPDSAvailability } from \"./opds2-availability\";\nimport { OPDSCopy } from \"./opds2-copy\";\nimport { OPDSFacet } from \"./opds2-facet\";\nimport { OPDSGroup } from \"./opds2-group\";\nimport { OPDSHold } from \"./opds2-hold\";\nimport { OPDSLink } from \"./opds2-link\";\nimport { OPDSMetadata } from \"./opds2-metadata\";\nimport { OPDSProperties } from \"./opds2-properties\";\nimport { OPDSPublication } from \"./opds2-publication\";\n\n// application/opds+json\n\nconst METADATA_JSON_PROP = \"metadata\";\nconst FACETS_JSON_PROP = \"facets\";\nconst GROUPS_JSON_PROP = \"groups\";\nconst CATALOGS_JSON_PROP = \"catalogs\";\nconst PUBLICATIONS_JSON_PROP = \"publications\";\nconst LINKS_JSON_PROP = \"links\";\nconst NAVIGATION_JSON_PROP = \"navigation\";\n\nconst cloneLinkInfo = (linkSource: OPDSLink, linkDest: OPDSLink) => {\n\n    if (!linkDest.Href && linkSource.Href) {\n        linkDest.Href = linkSource.Href;\n    }\n    if (!linkDest.TypeLink && linkSource.TypeLink) {\n        linkDest.TypeLink = linkSource.TypeLink;\n    }\n    if (!linkDest.Title && linkSource.Title) {\n        linkDest.Title = linkSource.Title;\n    }\n    if ((!linkDest.Rel || !linkDest.Rel.length) && linkSource.Rel) {\n        for (const r of linkSource.Rel) {\n            linkDest.AddRel(r);\n        }\n    }\n\n    if (linkSource.Properties) {\n\n        if (linkSource.Properties.Availability) {\n            if (!linkDest.Properties) {\n                linkDest.Properties = new OPDSProperties();\n            }\n            linkDest.Properties.Availability = new OPDSAvailability();\n            if (linkSource.Properties.Availability.Since) {\n                linkDest.Properties.Availability.Since = linkSource.Properties.Availability.Since;\n            }\n            if (linkSource.Properties.Availability.Until) {\n                linkDest.Properties.Availability.Until = linkSource.Properties.Availability.Until;\n            }\n            if (linkSource.Properties.Availability.State) {\n                linkDest.Properties.Availability.State = linkSource.Properties.Availability.State;\n            }\n        }\n\n        if (linkSource.Properties.Copies) {\n            if (!linkDest.Properties) {\n                linkDest.Properties = new OPDSProperties();\n            }\n            linkDest.Properties.Copies = new OPDSCopy();\n            if (typeof linkSource.Properties.Copies.Available === \"number\") {\n                linkDest.Properties.Copies.Available = linkSource.Properties.Copies.Available;\n            }\n            if (typeof linkSource.Properties.Copies.Total === \"number\") {\n                linkDest.Properties.Copies.Total = linkSource.Properties.Copies.Total;\n            }\n        }\n\n        if (linkSource.Properties.Holds) {\n            if (!linkDest.Properties) {\n                linkDest.Properties = new OPDSProperties();\n            }\n            linkDest.Properties.Holds = new OPDSHold();\n            if (typeof linkSource.Properties.Holds.Position === \"number\") {\n                linkDest.Properties.Holds.Position = linkSource.Properties.Holds.Position;\n            }\n            if (typeof linkSource.Properties.Holds.Total === \"number\") {\n                linkDest.Properties.Holds.Total = linkSource.Properties.Holds.Total;\n            }\n        }\n\n        if (typeof linkSource.Properties.NumberOfItems === \"number\") {\n            if (!linkDest.Properties) {\n                linkDest.Properties = new OPDSProperties();\n            }\n            linkDest.Properties.NumberOfItems = linkSource.Properties.NumberOfItems;\n        }\n    }\n};\n\n@JsonObject()\nexport class OPDSFeed {\n\n    // TODO: not in JSON Schema?? https://github.com/opds-community/drafts/issues/23\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/opds-community/drafts/blob/2d027051a725ae62defdc7829b597564e5b8e9e5/schema/feed.schema.json\n    @JsonProperty(\"@context\")\n    @JsonElementType(String)\n    @JsonConverter(JsonStringConverter)\n    public Context!: string[];\n\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/opds-community/drafts/blob/2d027051a725ae62defdc7829b597564e5b8e9e5/schema/feed.schema.json#L7\n    @JsonProperty(METADATA_JSON_PROP)\n    public Metadata!: OPDSMetadata;\n\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/opds-community/drafts/blob/2d027051a725ae62defdc7829b597564e5b8e9e5/schema/feed.schema.json#L11\n    @JsonProperty(LINKS_JSON_PROP)\n    @JsonElementType(OPDSLink)\n    public Links!: OPDSLink[];\n\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/opds-community/drafts/blob/2d027051a725ae62defdc7829b597564e5b8e9e5/schema/feed.schema.json#L40\n    @JsonProperty(PUBLICATIONS_JSON_PROP)\n    @JsonElementType(OPDSPublication)\n    public Publications!: OPDSPublication[];\n\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/opds-community/drafts/blob/2d027051a725ae62defdc7829b597564e5b8e9e5/schema/feed.schema.json#L48\n    @JsonProperty(NAVIGATION_JSON_PROP)\n    @JsonElementType(OPDSLink)\n    public Navigation!: OPDSLink[];\n\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/opds-community/drafts/blob/2d027051a725ae62defdc7829b597564e5b8e9e5/schema/feed.schema.json#L66\n    @JsonProperty(FACETS_JSON_PROP)\n    @JsonElementType(OPDSFacet)\n    public Facets!: OPDSFacet[];\n\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/opds-community/drafts/blob/2d027051a725ae62defdc7829b597564e5b8e9e5/schema/feed.schema.json#L86\n    @JsonProperty(GROUPS_JSON_PROP)\n    @JsonElementType(OPDSGroup)\n    public Groups!: OPDSGroup[];\n\n    // https://libraryregistry.librarysimplified.org/libraries\n    // http://libraries.aldiko.com/home.json => https://libraries.aldiko.com/countries/france.json etc.\n    @JsonProperty(CATALOGS_JSON_PROP)\n    @JsonElementType(OPDSPublication)\n    public Catalogs!: OPDSPublication[];\n\n    public findFirstLinkByRel(rel: string): OPDSLink | undefined {\n\n        return this.Links ? this.Links.find((l) => {\n            return l.HasRel(rel);\n        }) : undefined;\n    }\n\n    public AddLink(href: string, rel: string, typeLink: string, templated: boolean) {\n        const l = new OPDSLink();\n        l.Href = href;\n        l.AddRel(rel);\n        l.TypeLink = typeLink;\n        if (templated) {\n            l.Templated = true;\n        }\n        if (!this.Links) {\n            this.Links = [];\n        }\n        this.Links.push(l);\n    }\n\n    public AddNavigation(title: string, href: string, rel: string, typeLink: string) {\n        const l = new OPDSLink();\n        l.Href = href;\n        l.TypeLink = typeLink;\n        l.AddRel(rel);\n        if (title) {\n            l.Title = title;\n        }\n        if (!this.Navigation) {\n            this.Navigation = [];\n        }\n        this.Navigation.push(l);\n    }\n\n    public AddPagination(\n        numberItems: number, itemsPerPage: number, currentPage: number,\n        nextLink?: string, prevLink?: string,\n        firstLink?: string, lastLink?: string) {\n\n        if (!this.Metadata) {\n            this.Metadata = new OPDSMetadata();\n        }\n        this.Metadata.CurrentPage = currentPage;\n        this.Metadata.ItemsPerPage = itemsPerPage;\n        this.Metadata.NumberOfItems = numberItems;\n\n        if (nextLink) {\n            this.AddLink(nextLink, \"next\", \"application/opds+json\", false);\n        }\n        if (prevLink) {\n            this.AddLink(prevLink, \"previous\", \"application/opds+json\", false);\n        }\n        if (firstLink) {\n            this.AddLink(firstLink, \"first\", \"application/opds+json\", false);\n        }\n        if (lastLink) {\n            this.AddLink(lastLink, \"last\", \"application/opds+json\", false);\n        }\n    }\n\n    public AddFacet(link: OPDSLink, group: string) {\n\n        if (this.Facets) {\n            const found = this.Facets.find((f) => {\n                if (f.Metadata && f.Metadata.Title === group) {\n                    if (!f.Links) {\n                        f.Links = [];\n                    }\n                    f.Links.push(link);\n                    return true;\n                }\n                return false;\n            });\n            if (found) {\n                return;\n            }\n        }\n\n        const facet = new OPDSFacet();\n\n        facet.Metadata = new OPDSMetadata();\n        facet.Metadata.Title = group;\n\n        facet.Links = [];\n        facet.Links.push(link);\n\n        if (!this.Facets) {\n            this.Facets = [];\n        }\n        this.Facets.push(facet);\n    }\n\n    public AddPublicationInGroup(publication: OPDSPublication, collLink: OPDSLink) {\n\n        if (this.Groups) {\n            const found1 = this.Groups.find((g) => {\n                if (g.Links) {\n                    const found2 = g.Links.find((l) => {\n\n                        if (l.Href === collLink.Href) {\n                            if (!g.Publications) {\n                                g.Publications = [];\n                            }\n                            g.Publications.push(publication);\n                            return true;\n                        }\n                        return false;\n                    });\n                    if (found2) {\n                        return true;\n                    }\n                }\n                return false;\n            });\n\n            if (found1) {\n                return;\n            }\n        }\n\n        const group = new OPDSGroup();\n        group.Metadata = new OPDSMetadata();\n        group.Metadata.Title = collLink.Title;\n\n        group.Publications = [];\n        group.Publications.push(publication);\n\n        const linkSelf = new OPDSLink();\n        linkSelf.AddRel(\"self\"); // note that existing collLink.Rel will not be ported to linkSelf!\n        cloneLinkInfo(collLink, linkSelf);\n\n        group.Links = [];\n        group.Links.push(linkSelf);\n\n        if (!this.Groups) {\n            this.Groups = [];\n        }\n        this.Groups.push(group);\n    }\n\n    public AddNavigationInGroup(link: OPDSLink, collLink: OPDSLink) {\n\n        if (this.Groups) {\n            const found1 = this.Groups.find((g) => {\n                if (g.Links) {\n                    const found2 = g.Links.find((l) => {\n\n                        if (l.Href === collLink.Href) {\n                            if (!g.Navigation) {\n                                g.Navigation = [];\n                            }\n                            g.Navigation.push(link);\n                            return true;\n                        }\n                        return false;\n                    });\n                    if (found2) {\n                        return true;\n                    }\n                }\n                return false;\n            });\n\n            if (found1) {\n                return;\n            }\n        }\n\n        const group = new OPDSGroup();\n        group.Metadata = new OPDSMetadata();\n        group.Metadata.Title = collLink.Title;\n\n        group.Navigation = [];\n        group.Navigation.push(link);\n\n        const linkSelf = new OPDSLink();\n        linkSelf.AddRel(\"self\"); // note that existing collLink.Rel will not be ported to linkSelf!\n        cloneLinkInfo(collLink, linkSelf);\n\n        group.Links = [];\n        group.Links.push(linkSelf);\n\n        if (!this.Groups) {\n            this.Groups = [];\n        }\n        this.Groups.push(group);\n    }\n\n    @OnDeserialized()\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore: TS6133 (is declared but its value is never read.)\n    protected _OnDeserialized() {\n        // tslint:disable-next-line:max-line-length\n        // https://github.com/opds-community/drafts/blob/2d027051a725ae62defdc7829b597564e5b8e9e5/schema/feed.schema.json#L121\n        if (!this.Metadata) {\n            console.log(\"OPDS2Feed.Metadata is not set!\");\n        }\n        // tslint:disable-next-line:max-line-length\n        // https://github.com/opds-community/drafts/blob/2d027051a725ae62defdc7829b597564e5b8e9e5/schema/feed.schema.json#L122\n        if (!this.Links) {\n            console.log(\"OPDS2Feed.Links is not set!\");\n        }\n        // tslint:disable-next-line:max-line-length\n        // https://github.com/opds-community/drafts/blob/2d027051a725ae62defdc7829b597564e5b8e9e5/schema/feed.schema.json#L127\n        if (!this.Publications && !this.Navigation && !this.Groups && !this.Catalogs) {\n            console.log(\"One of OPDS2Feed.Publications|Navigation|Groups|Catalogs must be set!\");\n        }\n    }\n}\n"]}